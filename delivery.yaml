build_steps:
  - desc: Prepare
    cmd: |
      curl -o /tmp/ensure-docker -f https://delivery.cloud.zalando.com/utils/ensure-docker
      chmod +x /tmp/ensure-docker
      /tmp/ensure-docker

  - desc: Build
    cmd: |
      function npm {
        docker run -i --rm -v "$(pwd):/workspace" -w /workspace registry.opensource.zalan.do/stups/node:latest npm "$@"
      }

      npm install --no-optional
      npm run dist

  - desc: Publish Docker image
    cmd:
      IMAGE=""
      docker build -t "$IMAGE"
      if [[ "${CDP_TARGET_BRANCH}" = "master" && -z "${CDP_PULL_REQUEST_NUMBER}" ]]; then
        docker push "$IMAGE"
      fi
